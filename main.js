(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),t.classList.remove("popup_is-animated"),document.addEventListener("keydown",n)}function e(t){t.classList.remove("popup_is-opened"),t.classList.add("popup_is-animated"),document.removeEventListener("keydown",n)}function n(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");n&&e(n)}}var r=function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&e(t.currentTarget)},o=document.querySelector("#card-template");function c(t,e,n,r,c,u){var i=o?o.content.querySelector(".places__item").cloneNode(!0):null;if(!i)return null;var a=i.querySelector(".card__image"),l=i.querySelector(".card__title"),s=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-count");return a&&l&&s&&p&&d?(a.src=t.link||"",a.alt=t.name||"",l.textContent=t.name||"Без названия",d.textContent=t.likes?t.likes.length:0,t.likes&&t.likes.some((function(t){return t._id===c}))?p.classList.add("card__like-button_is-active"):p.classList.remove("card__like-button_is-active"),i.dataset.cardId=t._id||"",t.owner&&t.owner._id===c?s.addEventListener("click",(function(){n(t._id,i,u)})):s.remove(),p.addEventListener("click",(function(){return e(t._id,p,d)})),a.addEventListener("click",r),i):null}function u(t,e,n,r,o){(e.classList.contains("card__like-button_is-active")?o(t):r(t)).then((function(t){e.classList.toggle("card__like-button_is-active"),n.textContent=t.likes.length})).catch((function(t){console.error("Ошибка при обработке лайка:",t)}))}function i(t,e,n){n(t).then((function(){e.remove()})).catch((function(t){console.error("Ошибка при удалении карточки:",t)}))}var a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"},l=function(t,e,n){var r=t.querySelector("#".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},s=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid||""===t.value.trim()}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)},p=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){n.setCustomValidity(""),l(t,n,e)})),s(n,r,e)},d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-33",headers:{authorization:"1b4b2558-fdd9-468b-bcf2-a18254476256","Content-Type":"application/json"}},f=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",headers:d.headers};return e&&(n.body=JSON.stringify(e)),fetch("".concat(d.baseUrl).concat(t),n).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))},_=function(t){return f("/cards/".concat(t),"DELETE")},m=function(t){return f("/cards/likes/".concat(t),"PUT")},v=function(t){return f("/cards/likes/".concat(t),"DELETE")};function y(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e?(t.textContent=r,t.disabled=!0):(t.textContent=n,t.disabled=!1)}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var b,h=document.querySelector(".places__list"),q=document.querySelectorAll(".popup"),g=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_image"),E=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),x=document.querySelector('.popup__form[name="edit-profile"]'),A=document.querySelector('.popup__form[name="new-place"]'),w=x.querySelector(".popup__input_type_name"),T=x.querySelector(".popup__input_type_description"),j=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),D=A.querySelector(".popup__input_type_card-name"),I=A.querySelector(".popup__input_type_url"),P=document.querySelector(".popup__image"),M=document.querySelector(".profile__edit-avatar-button"),O=document.querySelector(".popup_type_edit-avatar"),U=document.querySelector('.popup__form[name="edit-avatar"]'),V=U.querySelector(".popup__input_type_avatar-url");function H(e){var n=e.target.closest(".card").querySelector(".card__title").textContent,r=e.target.src;P.src=r,P.alt=n,document.querySelector(".popup__caption").textContent=n,t(L)}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);s(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){var r;e.validity.patternMismatch?e.setCustomValidity(function(t){return t.dataset.errorMessage||t.validationMessage}(e)):e.setCustomValidity(""),"url"===e.type&&e.validity.valid&&(r=e.value,/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|bmp|webp))$/i.test(r)?e.setCustomValidity(""):e.setCustomValidity("Указанный URL не ведёт на изображение.")),e.validity.valid?l(t,e,n):function(t,e,n,r){var o=t.querySelector("#".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),s(n,r,e)}))}))}(e,t)}))}(a),x.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=x.querySelector(".popup__button"),c=o.textContent;y(o,!0,c),(n=w.value,r=T.value,f("/users/me","PATCH",{name:n,about:r})).then((function(t){!function(t,e){j.textContent=t,B.textContent=e}(t.name,t.about),e(g)})).catch((function(t){console.error("Ошибка при обновлении профиля:",t)})).finally((function(){y(o,!1,c)}))})),E.addEventListener("click",(function(){w.value=j.textContent,T.value=B.textContent,p(x,a),t(g)})),A.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=A.querySelector(".popup__button"),l=o.textContent;y(o,!0,l),(n=D.value,r=I.value,f("/cards","POST",{name:n,link:r})).then((function(t){var n=c(t,(function(t,e,n){return u(t,e,n,m,v)}),i,H,b,_);h.prepend(n),e(C),A.reset()})).catch((function(t){console.error("Ошибка при добавлении карточки:",t)})).finally((function(){y(o,!1,l),p(A,a)}))})),k.addEventListener("click",(function(){t(C)})),U.addEventListener("submit",(function(t){t.preventDefault();var n,r=U.querySelector(".popup__button"),o=r.textContent;y(r,!0,o),(n=V.value,f("/users/me/avatar","PATCH",{avatar:n})).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url('".concat(t.avatar,"')"),e(O)})).catch((function(t){console.error("Ошибка при обновлении аватара:",t)})).finally((function(){y(r,!1,o)}))})),M.addEventListener("click",(function(){U.reset(),p(U,a),t(O)})),q.forEach((function(t){t.addEventListener("mousedown",r)})),Promise.all([f("/users/me"),f("/cards").then((function(t){return console.log(t),t}))]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];b=o._id,j.textContent=o.name,B.textContent=o.about,document.querySelector(".profile__image").style.backgroundImage="url('".concat(o.avatar,"')"),a.forEach((function(t){var e=c(t,(function(t,e,n){return u(t,e,n,m,v)}),i,H,b,_);h.appendChild(e)}))})).catch((function(t){console.log(t)}))})();